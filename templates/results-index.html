{% extends "base.html" %}
{% block introduction %}
{% if msgs.lede %}
  <div class="hatnote">
    🔗 <a href="/id/{{abif_id}}">{{abif_id}}</a> &nbsp; &nbsp;
    (tags: { {% for t in msgs.taglist %}
    <a href="/tag/{{t}}">{{t}}</a>
    {% if not loop.last %}, {% endif %}
    {% endfor %}
    })
  </div>
<p>{{ msgs.lede | safe }}</p>
{% else %}
<p>Your .abif has been processed.  See <a href="#results">results below</a></p>
{% endif %}
{% endblock introduction %}
{% block content %}
{% set all_results_generated = (result_types|length == 5) %}
{% include 'abifbox-snippet.html' %}
<h2 id="results">{{ webenv.statusStr }}Results</h2>
{% if abif_id %}
{% set pathpart="/id/" + abif_id  %}
{% set abslink=webenv.base_url + pathpart %}
<!-- BEGIN .hatnote -->
<div class="hatnote">🔗<a href="{{abslink}}">{{abslink}}</a></div>
<!-- END .hatnote -->
{% endif %}
{% if msgs.results_name %}
<p>The {{msgs.results_name}} of {{abif_id}} are below,
and can be edited in the field above.</p>
{% elif msgs.results_lede %}
{# msgs.results_lede is DEPRECATED as of 2024-06-19 #}
<p>{{ msgs.results_lede | safe }}</p>
{% else %}
<p>Below are various abiftool output blocks for the ABIF above.
  {% endif %}
  <table style="max-width: 60em; border-collapse: collapse;">
    {% if 'dot' in result_types %}
    <tr>
      <td style="padding: 0.25em 1em 0.25em 0; vertical-align: top;">
        <a href="#dot">Pairwise (Condorcet/Copeland) diagram</a>
      </td>
      <td style="padding: 0.25em 0; vertical-align: top;">
        Winner: {% if copewinnerstring and FPTP_candnames %}
          {%- set winner_tokens = copewinnerstring.split(',') -%}
          {%- for tok in winner_tokens -%}
            <span class="color-box" style="background-color: {{ colordict[tok.strip()] | default('#ccc') }};"></span>{{ FPTP_candnames[tok.strip()] if tok.strip() in FPTP_candnames else tok.strip() }}{% if not loop.last %}, {% endif %}
          {%- endfor -%}
        {% elif copewinnerstring %}
          {{ copewinnerstring }}
        {% else %}
          N/A
        {% endif %}
      </td>
    </tr>
    {% endif %}
    {% if 'wlt' in result_types %}
    <tr>
      <td style="padding: 0.25em 1em 0.25em 0; vertical-align: top;">
        <a href="#wlt">Win-loss-tie (Condorcet/Copeland) table</a>
      </td>
      <td style="padding: 0.25em 0; vertical-align: top;">
        Winner: {% if copewinnerstring and FPTP_candnames %}
          {%- set winner_tokens = copewinnerstring.split(',') -%}
          {%- for tok in winner_tokens -%}
            <span class="color-box" style="background-color: {{ colordict[tok.strip()] | default('#ccc') }};"></span>{{ FPTP_candnames[tok.strip()] if tok.strip() in FPTP_candnames else tok.strip() }}{% if not loop.last %}, {% endif %}
          {%- endfor -%}
        {% elif copewinnerstring %}
          {{ copewinnerstring }}
        {% else %}
          N/A
        {% endif %}
      </td>
    </tr>
    {% endif %}
    {% if 'FPTP' in result_types %}
    <tr>
      <td style="padding: 0.25em 1em 0.25em 0; vertical-align: top;">
        <a href="#FPTP">FPTP output</a>
      </td>
      <td style="padding: 0.25em 0; vertical-align: top;">
        {{ "Winners (tie):" if resblob and resblob['FPTP_result'] and resblob['FPTP_result']['winners'] and resblob['FPTP_result']['winners'] | length > 1 else "Winner:" }} {% if FPTP_candnames and resblob and resblob['FPTP_result'] and resblob['FPTP_result']['winners'] %}
          {% set winner_token = resblob['FPTP_result']['winners'][0] %}
          <span class="color-box" style="background-color: {{ colordict[winner_token] | default('#ccc') }};"></span>{{ FPTP_candnames[winner_token] if winner_token in FPTP_candnames else winner_token }}
        {% elif resblob and resblob['FPTP_result'] and resblob['FPTP_result']['winners'] %}
          {{ resblob['FPTP_result']['winners'][0] }}
        {% else %}
          N/A
        {% endif %}
      </td>
    </tr>
    {% endif %}
    {% if 'IRV' in result_types %}
    <tr>
      <td style="padding: 0.25em 1em 0.25em 0; vertical-align: top;">
        <a href="#IRV">IRV output</a>
      </td>
      <td style="padding: 0.25em 0; vertical-align: top;">
        {{ "Winners (tie):" if IRV_dict and IRV_dict['winner'] and IRV_dict['winner'] | length > 1 else "Winner:" }}
        {% if IRV_dict and IRV_dict['winner'] and IRV_candnames %}
          {%- for winner_token in IRV_dict['winner'] -%}
            <span class="color-box" style="background-color: {{ colordict[winner_token] | default('#ccc') }};"></span>{{ IRV_candnames[winner_token] if winner_token in IRV_candnames else winner_token }}{% if not loop.last %}, {% endif %}
          {%- endfor -%}
        {% elif IRV_dict and IRV_dict['winnerstr'] %}
          {{ IRV_dict['winnerstr'] }}
        {% else %}
          N/A
        {% endif %}
      </td>
    </tr>
    {% endif %}
    {% if 'STAR' in result_types %}
    <tr>
      <td style="padding: 0.25em 1em 0.25em 0; vertical-align: top;">
        <a href="#STAR">STAR output</a>
      </td>
      <td style="padding: 0.25em 0; vertical-align: top;">
        Winner: 
        {% if scorestardict and scorestardict['scoremodel']['winner'] and FPTP_candnames %}
          {% set winner_name = scorestardict['scoremodel']['winner'] %}
          {% set winner_token = namespace(value=None) %}
          {% for cand_token in scorestardict['scoremodel']['ranklist'] %}
            {% if scorestardict['scoremodel']['scores'][cand_token]['candname'] == winner_name and winner_token.value is none %}
              {% set winner_token.value = cand_token %}
            {% endif %}
          {% endfor %}
          {% if winner_token.value %}
            <span class="color-box" style="background-color: {{ colordict[winner_token.value] | default('#ccc') }};"></span>{{ winner_name }}
          {% else %}
            {{ winner_name }}
          {% endif %}
        {% elif scorestardict and scorestardict['scoremodel']['winner'] %}
          {{ scorestardict['scoremodel']['winner'] }}
        {% else %}
          N/A
        {% endif %}
      </td>
    </tr>
    {% endif %}
    {% if 'approval' in result_types %}
    <tr>
      <td style="padding: 0.25em 1em 0.25em 0; vertical-align: top;">
        <a href="#approval">Approval voting output</a>
      </td>
      <td style="padding: 0.25em 0; vertical-align: top;">
        {{ "Winners (tie):" if approval_result and approval_result['winners'] and approval_result['winners'] | length > 1 else "Winner:" }} {% if approval_result and approval_result['winners'] and FPTP_candnames %}
          {%- for winner in approval_result['winners'] -%}
            <span class="color-box" style="background-color: {{ colordict[winner] | default('#ccc') }};"></span>{{ FPTP_candnames[winner] if winner in FPTP_candnames else winner }}{% if not loop.last %}, {% endif %}
          {%- endfor -%}
        {% elif approval_result and approval_result['winners'] %}
          {% for winner in approval_result['winners'] %}<span class="color-box" style="background-color: {{ colordict[winner] | default('#ccc') }};"></span>{{ winner }}{% if not loop.last %}, {% endif %}{% endfor %}
        {% else %}
          N/A
        {% endif %}
      </td>
    </tr>
    {% endif %}
  </table>
  {% if abif_id and not all_results_generated %}
  <ul>
    <li>Generate other results for {{abif_id}}:</li>
    <ul>
      {% if not 'dot' in result_types %}
      <li>
        <a href="/id/{{abif_id}}/dot#dot">Pairwise (Condorcet/Copeland) diagram for {{abif_id}}</a>
      </li>
      {% endif %}
      {% if not 'wlt' in result_types %}
      <li>
        <a href="/id/{{abif_id}}/wlt#wlt">Win-loss-tie (Condorcet/Copeland) table for {{abif_id}}</a>
      </li>
      {% endif %}
      {% if not 'FPTP' in result_types %}
      <li>
        <a href="/id/{{abif_id}}/FPTP#FPTP">FPTP results for {{abif_id}}</a>
      </li>
      {% endif %}
      {% if not 'IRV' in result_types %}
      <li>
        <a href="/id/{{abif_id}}/IRV#IRV">IRV table for {{abif_id}}</a>
      </li>
      {% endif %}
      {% if not 'STAR' in result_types %}
      <li>
        <a href="/id/{{abif_id}}/STAR#STAR">STAR results for {{abif_id}}</a>
      </li>
      {% endif %}
      {% if not 'approval' in result_types %}
      <li>
        <a href="/id/{{abif_id}}/approval#approval">Approval voting results for {{abif_id}}</a>
      </li>
      {% endif %}
    </ul>
    <li><a href="/id/{{abif_id}}/all">Generate all results for {{abif_id}}</a></li>
    {% endif %}
  </ul>
</p>
<!-- BEGIN .resultbox -->
<div class="resultbox">
<!-- BEGIN resultbox -->
{############ dot ############}
{% set restype="dot" %}
{% set rellink=restype + "#" + restype %}
{% if 'dot' in result_types and dotsvg_html %}
<h3><a name="{{restype}}"></a>Pairwise (Condorcet/Copeland) diagram</h3>
{% if abif_id %}
{% set pathpart="/id/" + abif_id + "/" + rellink %}
{% set abslink=webenv.base_url + pathpart %}
<!-- BEGIN .hatnote -->
<div class="hatnote">
  {{abif_id}} pairwise diagram permalink:<br>
  🔗<a href="{{abslink}}">{{abslink}}</a>
</div>
<!-- END .hatnote -->
<p><a href="/id/{{abif_id}}/dot/svg">{{ dotsvg_html | safe }}</a></p>
{% else %}
<p>{{ dotsvg_html | safe }}</p>
{% endif %}
{% endif %}
<!-- END dot section -->
{############ wlt ############}
{% set restype="wlt" %}
{% set rellink=restype + "#" + restype %}
{% if 'wlt' in result_types and pairwise_html %}
<h3><a name="{{restype}}"></a>Win-loss-tie (Condorcet/Copeland) table</h3>
{% if abif_id %}
{% set pathpart="/id/" + abif_id + "/" + rellink %}
{% set abslink=webenv.base_url + pathpart %}
<!-- BEGIN .hatnote -->
<div class="hatnote">
  {{abif_id}} w-l-t table permalink:<br>
  🔗<a href="{{abslink}}">{{abslink}}</a>
</div>
<!-- END .hatnote -->
{% endif %}
<p><b>Pairwise winner(s)</b>:
  {% if copewinnerstring and FPTP_candnames %}
    {%- set winner_tokens = copewinnerstring.split(',') -%}
    {%- for tok in winner_tokens -%}
      {{ FPTP_candnames[tok.strip()] if tok.strip() in FPTP_candnames else tok.strip() }}{% if not loop.last %}, {% endif %}
    {%- endfor -%}
  {% elif copewinnerstring %}
    {{ copewinnerstring }}
  {% else %}
    N/A
  {% endif %}
</p>
  {{ pairwise_html | safe }}
{% endif %}
<!-- END wlt section -->
{############ FPTP ############}
{% set restype="FPTP" %}
{% set rellink=restype + "#" + restype %}
{#{% if 'FPTP' in result_types and resblob['FPTP_result'] %}#}
{% if 'FPTP' in result_types %}

<h3><a name="{{restype}}"></a>FPTP result</h3>
{% if abif_id %}
{% set pathpart="/id/" + abif_id + "/" + rellink %}
{% set abslink=webenv.base_url + pathpart %}
<!-- BEGIN .hatnote -->
<div class="hatnote">
  "FPTP" is "First-past-the-post", also known as "plurality" or "choose-one"<br>
  {{abif_id}} FPTP results permalink:<br>
  🔗<a href="{{abslink}}">{{abslink}}</a><br>
</div>
<!-- END .hatnote -->
{% endif %}
<p>{% include 'fptp-snippet.html' %}</p>
{% endif %}
<!-- END FPTP section -->
{############ IRV ############}
{% set restype="IRV" %}
{% set rellink=restype + "#" + restype %}
{% if 'IRV' in result_types and IRV_dict %}
<h3><a name="{{restype}}"></a>IRV/RCV results</h3>
{% if abif_id %}
{% set pathpart="/id/" + abif_id + "/" + rellink %}
{% set abslink=webenv.base_url + pathpart %}
<div class="hatnote">
  {{abif_id}} IRV/RCV result permalink:<br>
  🔗<a href="{{abslink}}">{{abslink}}</a>
</div>
{% endif %}
<!-- BEGIN results-container -->
<div id="results-container" data-candidate-colors='{{ colordict | tojson | safe }}'>
    <p>{% include 'irv-snippet.html' %}</p>
</div>
<!-- END results-container -->

<script type="module" src="{{ url_for('static', filename='js/main.js') }}"></script>
{% endif %}
<!-- END IRV section -->
{############ STAR ############}
{% set restype="STAR" %}
{% set rellink=restype + "#" + restype %}
{% if 'STAR' in result_types and STAR_html %}
<h3><a name="{{restype}}"></a>STAR results</h3>
{% if abif_id %}
{% set pathpart="/id/" + abif_id + "/" + rellink %}
{% set abslink=webenv.base_url + pathpart %}
<!-- BEGIN .hatnote -->
<div class="hatnote">
  {{abif_id}} STAR results permalink:<br>
  🔗<a href="{{abslink}}">{{abslink}}</a>
</div>
<!-- END .hatnote -->
{% endif %}
{% if scorestardict and scorestardict['star_lede'] %}
<p class="description">
   {{ scorestardict['star_lede'] }}
</p>
{% endif %}
<p>{% include 'star-snippet.html' %}</p>
{% if scorestardict and scorestardict['star_foot'] %}
<p class="description">
  {{ scorestardict['star_foot'] }}
</p>
{% endif %}
{% endif %}
<!-- END STAR section -->
{############ Approval Voting ############}
{% set restype="approval" %}
{% set rellink=restype + "#" + restype %}
{% if 'approval' in result_types and approval_text %}
<h3><a name="{{restype}}"></a>Approval voting results</h3>
{% if abif_id %}
{% set pathpart="/id/" + abif_id + "/" + rellink %}
{% set abslink=webenv.base_url + pathpart %}
<!-- BEGIN .hatnote -->
<div class="hatnote">
  {{abif_id}} approval voting results permalink:<br>
  🔗<a href="{{abslink}}">{{abslink}}</a>
</div>
<!-- END .hatnote -->
{% endif %}

<!-- BEGIN approval notices -->
{% if approval_notices %}
{% for notice in approval_notices %}
<div class="notice-banner notice-{{ notice.notice_type }}">
  <div class="notice-icon">
    {% if notice.notice_type == 'disclaimer' %}📝
    {# Other possible notice types: ⚠️ warning, ℹ️ info, 🐛 debug, 📌 general #}
    {% else %}�
    {% endif %}
  </div>
  <div class="notice-content">
    <div class="notice-text"><b>Note</b> — {{ notice.short }}</div>
    {% if notice.long %}
    <details style="margin-top: 0.5em;">
      <summary style="cursor: pointer; color: inherit; opacity: 0.8;">Details</summary>
      <div style="margin-top: 0.5em; padding-left: 1em; font-size: 0.9em; line-height: 1.5;">
        {{ notice.long }}
      </div>
    </details>
    {% endif %}
  </div>
</div>
{% endfor %}
{% endif %}
<!-- END approval notices -->

{% include 'approval-snippet.html' %}
{% endif %}
<!-- END Approval Voting section -->
<!-- END resultbox -->
</div>
<!-- END .resultbox -->
<p>(<a href="/">homepage</a>)</p>
{% endblock content %}
